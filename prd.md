# 灯塔探险 - 产品需求文档 (PRD)

## 游戏概述

### 游戏名称
**灯塔探险 (Lighthouse Adventure)**

### 游戏类型
- 俯视角2.5D动作RPG探险游戏
- 平台：iOS
- 参考游戏：魔塔系列 + 现代动作射击元素

### 核心概念
玩家扮演一名勇敢的探险者，需要攀登一座神秘的100层灯塔。每一层都有独特的场景、敌人和挑战。通过战斗、收集资源、升级装备，最终击败塔顶的终极Boss。

## 核心玩法设计

### 1. 基础游戏循环

#### 1.1 探索机制
- **层级结构**：灯塔共100层，每层为一个独立场景
- **移动方式**：自由移动，玩家可在地图路径上任意移动
- **操作方式**：
  - **左手控制**：虚拟摇杆控制角色移动
  - **右手控制**：点击/滑动进行射击攻击
- **视角**：俯视角2.5D，可以看到角色和环境的立体效果
- **场景元素**：
  - 楼梯（上下层通道）
  - 宝箱（装备/道具）
  - 敌人巡逻区域
  - 机关/陷阱
  - NPC商人（特定层数）
  - 掩体和障碍物

#### 1.2 战斗系统
- **实时动作战斗**：射击+移动的动作游戏玩法
- **核心属性**：
  - 生命值 (HP)
  - 攻击力 (ATK) - 影响子弹伤害
  - 防御力 (DEF) - 减少受到的伤害
  - 移动速度 (SPD) - 角色移动速度
  - 射击速度 (FIRE_RATE) - 攻击频率
  - 射程 (RANGE) - 攻击距离
- **战斗机制**：
  - 玩家可以边移动边射击
  - 不同武器有不同的射击模式（单发、连发、散弹等）
  - 支持瞄准辅助系统
  - 弹药系统（可选，或无限弹药）

#### 1.3 敌人AI系统
- **巡逻状态**：
  - 敌人在指定区域内按路径巡逻
  - 巡逻路径可以是直线、圆形或自定义路径
  - 巡逻速度较慢，容易被玩家避开
- **发现机制**：
  - 敌人有视野范围（扇形或圆形检测区域）
  - 玩家进入视野范围后，敌人进入警戒状态
  - 视野范围会在屏幕上以半透明区域显示（可选）
- **追击状态**：
  - 发现玩家后，敌人开始主动追击
  - 追击速度比巡逻速度快
  - 会尝试接近玩家并发动攻击
  - 如果玩家脱离一定距离，敌人返回巡逻状态
- **攻击行为**：
  - 近战敌人：接近玩家后进行近身攻击
  - 远程敌人：保持距离进行射击攻击
  - 特殊敌人：具有特殊攻击模式（冲锋、法术等）

#### 1.4 成长系统
- **等级提升**：击败敌人获得经验值
- **属性成长**：升级时提升基础属性
- **装备系统**：
  - 武器（不同射击模式和伤害）
  - 防具（提升防御力和移动速度）
  - 饰品（提升特殊属性如射程、射速等）

### 2. 游戏内容设计

#### 2.1 层级设计原则
- **1-20层**：新手教学区域，敌人较弱，学习移动和射击
- **21-50层**：进阶区域，引入新敌人类型和复杂地形
- **51-80层**：挑战区域，需要策略性移动和精准射击
- **81-99层**：困难区域，强力敌人和复杂AI行为
- **100层**：Boss层，最终挑战

#### 2.2 敌人设计
- **史莱姆系列**（1-20层）：
  - 基础近战敌人，移动缓慢
  - 简单直线巡逻，发现范围小
- **骷髅战士系列**（15-40层）：
  - 中等速度近战敌人
  - 会使用简单的包围战术
- **元素法师系列**（30-60层）：
  - 远程攻击敌人，会保持距离
  - 发射魔法弹，有预判玩家位置的能力
- **巨龙守卫系列**（50-80层）：
  - 高血量敌人，移动缓慢但攻击力强
  - 有冲锋攻击，需要玩家灵活躲避
- **暗影刺客系列**（70-95层）：
  - 高速移动敌人，难以命中
  - 会使用瞬移或隐身技能
- **灯塔守护者**（100层）：
  - 终极Boss，多阶段战斗
  - 结合多种攻击模式和AI行为

#### 2.3 武器系统
- **手枪类**：
  - 单发射击，精准度高
  - 适合新手，弹道直线
- **冲锋枪类**：
  - 连发射击，射速快
  - 适合近距离战斗
- **霰弹枪类**：
  - 散弹射击，近距离伤害高
  - 适合对付多个敌人
- **狙击枪类**：
  - 远程高伤害，射速慢
  - 适合远距离精确打击
- **特殊武器**：
  - 激光枪、火焰喷射器等
  - 具有特殊效果和攻击模式

#### 2.4 道具系统
- **恢复道具**：
  - 医疗包：恢复HP
  - 能量饮料：临时提升移动速度
- **属性道具**：
  - 力量增强剂：永久+攻击力
  - 护甲强化剂：永久+防御力
  - 敏捷药剂：永久+移动速度
- **特殊道具**：
  - 传送装置：返回指定层数
  - 探测器：显示敌人位置和巡逻路径
  - 隐身斗篷：短时间内敌人无法发现玩家

### 3. 用户界面设计

#### 3.1 主游戏界面
- **游戏地图**：占据屏幕主要区域
- **左下角**：虚拟摇杆（移动控制）
- **右下角**：射击按钮/区域
- **顶部状态栏**：HP、弹药、等级、经验值
- **小地图**：显示当前层的布局和敌人位置（可选）

#### 3.2 控制界面优化
- **移动摇杆**：
  - 可自定义位置和大小
  - 支持透明度调节
  - 提供触觉反馈
- **射击控制**：
  - 点击射击：单发模式
  - 长按射击：连发模式
  - 滑动瞄准：精确瞄准
  - 自动瞄准辅助（可开关）

#### 3.3 战斗反馈界面
- **伤害数字**：清晰的伤害显示
- **敌人血条**：敌人头顶血量显示
- **警戒提示**：敌人发现玩家时的视觉提示
- **弹药显示**：当前武器弹药状态

### 4. 技术实现要点

#### 4.1 核心技术栈
- **引擎**：SpriteKit (iOS原生)
- **编程语言**：Swift
- **物理引擎**：SpriteKit Physics
- **数据存储**：Core Data / UserDefaults
- **音效**：AVAudioEngine

#### 4.2 关键系统
- **移动系统**：
  - 平滑的角色移动
  - 碰撞检测和路径寻找
  - 地形限制和障碍物处理
- **射击系统**：
  - 子弹物理模拟
  - 不同武器的弹道计算
  - 命中检测和伤害计算
- **AI系统**：
  - 状态机管理（巡逻/警戒/追击/攻击）
  - 视野检测算法
  - 路径寻找和移动AI
- **性能优化**：
  - 对象池管理（子弹、特效等）
  - 视野裁剪和LOD系统
  - 内存管理和资源预加载

### 5. 商业化设计

#### 5.1 付费模式
- **一次性付费**：完整游戏体验
- **可选内购**：
  - 额外存档位
  - 特殊武器皮肤包
  - 便利道具包（非必需）

#### 5.2 用户留存
- **成就系统**：各种挑战目标
- **排行榜**：最快通关时间、最高层数等
- **隐藏内容**：秘密房间、特殊武器

## 开发里程碑

### 第一阶段：核心玩法原型 (3-4周) ✅ 已完成
- [x] 基础移动系统（虚拟摇杆）
- [x] 简单射击系统
- [x] 基础敌人AI（巡逻+追击）
- [x] 碰撞检测和物理系统
- [x] 基础UI界面
- [x] 前5层测试内容

**第一阶段完成功能详情：**
- ✅ **玩家系统**：完整的玩家角色，支持移动、射击、升级
- ✅ **控制系统**：虚拟摇杆 + 射击区域，支持自动射击
- ✅ **敌人AI**：5种敌人类型，完整的状态机（巡逻/警戒/追击/攻击）
- ✅ **战斗系统**：实时射击战斗，伤害计算，血条显示
- ✅ **UI系统**：血条、经验条、弹药显示、消息提示
- ✅ **物理系统**：完整的碰撞检测和物理模拟
- ✅ **资源管理**：占位符资源系统，便于后续美术替换

### 第二阶段：系统完善 (4-5周)
- [ ] 完整武器系统
- [ ] 高级敌人AI行为
- [ ] 道具和背包系统
- [ ] 存档功能
- [ ] 前20层内容

### 第三阶段：内容扩展 (5-6周)
- [ ] 完整100层内容
- [ ] 音效和音乐
- [ ] 成就系统
- [ ] 性能优化和调试

### 第四阶段：发布准备 (2-3周)
- [ ] 最终测试和调优
- [ ] App Store准备
- [ ] 营销素材制作

## 技术架构总结

### 已实现的核心类
1. **Player.swift** - 玩家角色系统
2. **Enemy.swift** - 敌人AI系统  
3. **Bullet.swift** - 子弹和射击系统
4. **VirtualJoystick.swift** - 虚拟摇杆控制
5. **GameUI.swift** - 游戏界面系统
6. **GameScene.swift** - 主游戏场景
7. **PlaceholderAssets.swift** - 占位符资源系统

### 代码结构特点
- 🎯 **模块化设计**：每个系统独立，便于维护和扩展
- 🎨 **美术资源预留**：所有UI、角色、物品都使用变量管理
- 📱 **iOS优化**：严格遵循iOS开发规范，使用SpriteKit原生引擎
- 🎮 **触控优化**：专为触屏设备设计的操作体验
- 🔧 **易于调试**：完整的Xcode项目结构，便于调试和测试

### 性能表现
- **目标帧率**：60FPS
- **内存管理**：对象池管理子弹和特效
- **物理计算**：优化的碰撞检测
- **UI渲染**：分层渲染，减少重绘

---

*文档版本：v1.2*  
*最后更新：2024年*  
*第一阶段开发完成*

## 风险评估

### 技术风险
- **性能优化**：实时战斗和AI计算的性能要求
- **操作体验**：触屏操作的精确度和舒适度
- **数值平衡**：射击游戏的难度曲线设计

### 市场风险
- **竞品分析**：动作射击游戏竞争激烈
- **用户接受度**：传统魔塔玩家对动作元素的接受度

## 成功指标

- **技术指标**：60FPS流畅运行，操作延迟<50ms
- **用户指标**：平均游戏时长>45分钟，通关率>15%
- **商业指标**：首月下载量>1000，用户评分>4.2

---

*文档版本：v1.1*  
*最后更新：2025年*  
*负责人：xijian* 